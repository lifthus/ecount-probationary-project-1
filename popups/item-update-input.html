<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="/styles/common.css" />
        <title>1차 프로젝트 대비 과제</title>
    </head>
    <body>
        <div class="basic-title">■ 품목등록</div>
        <form class="filter-box" onsubmit="return onSubmit()" id="item-update-form">
            <div>
                <div class="filter-item">
                    <div class="flex-box">
                        <label class="w-100px">품목코드</label>
                        <input placeholder="품목코드" name="item-code" disabled />
                    </div>
                </div>
                <div class="filter-item">
                    <label class="w-100px">품목명</label>
                    <input placeholder="품목명" name="item-name" />
                </div>
            </div>
            <div class="flex-box">
                <button class="blue-btn" type="submit">저장</button>
                <button class="gray-btn" type="button" onclick="onDelete()">삭제</button>
                <button class="gray-btn" type="reset">다시작성</button>
                <button class="gray-btn" type="button" onclick="onClose()">닫기</button>
            </div>
        </form>
        <script src="/scripts/items.js" type="module"></script>
        <script src="/scripts/common.js"></script>
        <script type="module">
            import { ItemDTO, updateItem, getItem, deleteItem } from "/scripts/api/items.js";
            window.updateItem = updateItem;
            window.ItemDTO = ItemDTO;
            window.getItem = getItem;
            window.deleteItem = deleteItem;

            const form2 = document.getElementById("item-update-form");
            const itemName = form2.querySelector("input[name='item-name']");
            const urlParams2 = new URLSearchParams(window.location.search);
            const code2 = urlParams2.get("code");
            getItem(code2).then((item) => {
                itemName.defaultValue = item.name;
            });
        </script>
        <script>
            function onSubmit() {
                const form = document.getElementById("item-update-form");
                const formData = new FormData(form);
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get("code");
                const itemName = formData.get("item-name");
                updateItem(new ItemDTO(code, itemName));
                opener.location.reload();
                self.close();
                return false;
            }
            function onDelete() {
                const urlParams = new URLSearchParams(window.location.search);
                const code = urlParams.get("code");
                deleteItem(code);
                self.close();
            }
            function onClose() {
                self.close();
            }

            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get("code");
            const form = document.getElementById("item-update-form");
            const itemCodeInput = form.querySelector("input[name='item-code']");
            itemCodeInput.defaultValue = code;
        </script>
    </body>
    <footer></footer>
</html>
